<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Composited Web+Room+GMap</title><style>
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.highlight-default {
}
.highlight-gray {
	color: rgb(155,154,151);
}
.highlight-brown {
	color: rgb(100,71,58);
}
.highlight-orange {
	color: rgb(217,115,13);
}
.highlight-yellow {
	color: rgb(223,171,1);
}
.highlight-teal {
	color: rgb(15,123,108);
}
.highlight-blue {
	color: rgb(11,110,153);
}
.highlight-purple {
	color: rgb(105,64,165);
}
.highlight-pink {
	color: rgb(173,26,114);
}
.highlight-red {
	color: rgb(224,62,62);
}
.highlight-gray_background {
	background: rgb(235,236,237);
}
.highlight-brown_background {
	background: rgb(233,229,227);
}
.highlight-orange_background {
	background: rgb(250,235,221);
}
.highlight-yellow_background {
	background: rgb(251,243,219);
}
.highlight-teal_background {
	background: rgb(221,237,234);
}
.highlight-blue_background {
	background: rgb(221,235,241);
}
.highlight-purple_background {
	background: rgb(234,228,242);
}
.highlight-pink_background {
	background: rgb(244,223,235);
}
.highlight-red_background {
	background: rgb(251,228,228);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(55, 53, 47, 0.6);
	fill: rgba(55, 53, 47, 0.6);
}
.block-color-brown {
	color: rgb(100,71,58);
	fill: rgb(100,71,58);
}
.block-color-orange {
	color: rgb(217,115,13);
	fill: rgb(217,115,13);
}
.block-color-yellow {
	color: rgb(223,171,1);
	fill: rgb(223,171,1);
}
.block-color-teal {
	color: rgb(15,123,108);
	fill: rgb(15,123,108);
}
.block-color-blue {
	color: rgb(11,110,153);
	fill: rgb(11,110,153);
}
.block-color-purple {
	color: rgb(105,64,165);
	fill: rgb(105,64,165);
}
.block-color-pink {
	color: rgb(173,26,114);
	fill: rgb(173,26,114);
}
.block-color-red {
	color: rgb(224,62,62);
	fill: rgb(224,62,62);
}
.block-color-gray_background {
	background: rgb(235,236,237);
}
.block-color-brown_background {
	background: rgb(233,229,227);
}
.block-color-orange_background {
	background: rgb(250,235,221);
}
.block-color-yellow_background {
	background: rgb(251,243,219);
}
.block-color-teal_background {
	background: rgb(221,237,234);
}
.block-color-blue_background {
	background: rgb(221,235,241);
}
.block-color-purple_background {
	background: rgb(234,228,242);
}
.block-color-pink_background {
	background: rgb(244,223,235);
}
.block-color-red_background {
	background: rgb(251,228,228);
}
.select-value-color-default { background-color: rgba(206,205,202,0.5); }
.select-value-color-gray { background-color: rgba(155,154,151, 0.4); }
.select-value-color-brown { background-color: rgba(140,46,0,0.2); }
.select-value-color-orange { background-color: rgba(245,93,0,0.2); }
.select-value-color-yellow { background-color: rgba(233,168,0,0.2); }
.select-value-color-green { background-color: rgba(0,135,107,0.2); }
.select-value-color-blue { background-color: rgba(0,120,223,0.2); }
.select-value-color-purple { background-color: rgba(103,36,222,0.2); }
.select-value-color-pink { background-color: rgba(221,0,129,0.2); }
.select-value-color-red { background-color: rgba(255,0,26,0.2); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="46a797b3-d9e1-47dd-944d-2bed231a13e1" class="page sans"><header><h1 class="page-title">Composited Web+Room+GMap</h1><table class="properties"><tbody><tr class="property-row property-row-created_time"><th><span class="icon property-icon"><svg viewBox="0 0 14 14" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.4);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesCreatedAt"><path d="M6.98643729,14.0000972 C5.19579566,14.0000972 3.40419152,13.3106896 2.04245843,11.9323606 C-0.681017475,9.21200555 -0.680780251,4.76029539 2.04293482,2.04012507 C4.76664406,-0.68004331 9.22427509,-0.68004331 11.9480135,2.04013479 C13.272481,3.36277455 14,5.1330091 14,6.99552762 C14,8.87640182 13.2721894,10.6285043 11.9480135,11.9509302 C10.5679344,13.3105924 8.77756503,14.0000972 6.98643729,14.0000972 Z M10.2705296,7.00913883 L10.2705296,8.46099754 L10.2705296,8.65543362 L10.076181,8.65543362 L8.6543739,8.65543362 L5.72059514,8.65543362 L5.52619796,8.65543362 L5.52619796,8.46099754 L5.52619796,5.52541044 L5.52619796,3.37946773 L5.52619796,3.18502193 L5.72059514,3.18502193 L7.17253164,3.18502193 L7.36692883,3.18502193 L7.36692883,3.37946773 L7.36692883,6.81467358 L10.076181,6.81467358 L10.2705296,6.81467358 L10.2705296,7.00913883 Z M12.1601539,6.99552762 C12.1601539,5.61697497 11.6190112,4.32597154 10.6393933,3.34769528 C8.63253764,1.34336744 5.35197452,1.34061603 3.34153136,3.33944106 C3.33868273,3.34219247 3.33607716,3.34494388 3.33322852,3.34769528 C1.32397148,5.35459953 1.32372842,8.63641682 3.33322852,10.6433794 C5.34295224,12.6504489 8.62968901,12.6504489 10.6393933,10.6433794 C11.6190112,9.66506426 12.1601539,8.37408027 12.1601539,6.99552762 Z"></path></svg></span>Created</th><td><time>@Feb 18, 2021 6:10 PM</time></td></tr><tr class="property-row property-row-multi_select"><th><span class="icon property-icon"><svg viewBox="0 0 14 14" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.4);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesMultipleSelect"><path d="M4,3 C4,2.447715 4.447715,2 5,2 L12,2 C12.5523,2 13,2.447716 13,3 C13,3.55228 12.5523,4 12,4 L5,4 C4.447715,4 4,3.55228 4,3 Z M4,7 C4,6.447715 4.447715,6 5,6 L12,6 C12.5523,6 13,6.447716 13,7 C13,7.55228 12.5523,8 12,8 L5,8 C4.447715,8 4,7.55228 4,7 Z M4,11 C4,10.447715 4.447715,10 5,10 L12,10 C12.5523,10 13,10.447716 13,11 C13,11.55228 12.5523,12 12,12 L5,12 C4.447715,12 4,11.55228 4,11 Z M2,4 C1.44771525,4 1,3.55228475 1,3 C1,2.44771525 1.44771525,2 2,2 C2.55228475,2 3,2.44771525 3,3 C3,3.55228475 2.55228475,4 2,4 Z M2,8 C1.44771525,8 1,7.55228475 1,7 C1,6.44771525 1.44771525,6 2,6 C2.55228475,6 3,6.44771525 3,7 C3,7.55228475 2.55228475,8 2,8 Z M2,12 C1.44771525,12 1,11.5522847 1,11 C1,10.4477153 1.44771525,10 2,10 C2.55228475,10 3,10.4477153 3,11 C3,11.5522847 2.55228475,12 2,12 Z"></path></svg></span>Tags</th><td></td></tr></tbody></table></header><div class="page-body"><nav id="e6c0f110-255f-4218-bbd1-483b564fd7b5" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#e49144cb-6ddc-4e3a-a272-aa427b770355"> 1. Web API + Room DB</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e7184f35-1ae6-4f22-b0be-44310db6e54e">Work Flow</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#dc8eb403-e4df-4b89-b099-0cfaa6d9fe7b">Room DB 구성 코드</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#07a83e9a-cae2-4ffa-9f18-aa6b1764364d">Main 페이지(Activity) 코드</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#dbe37d30-149d-4bf1-8f6e-6490048b54fc">handler Room DB on Java</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#75cfc78c-b162-47b5-b66b-809483d81742">getWebAPI 페이지 코드</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#7525170d-f119-43d7-ba8b-46989f62086f">추가 설정 코드</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a332dcd6-abf1-4767-b638-24cd988a94ee"> 2. Web + Room + Map</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e297939e-219b-465e-95d0-7c9b39e9c160">[Google Map] 현위치 가져오기</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#602a52d6-2246-44f1-bdb2-f4404a962a22">[Google Map] 지도 위에 마크찍기</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#c1b32757-a157-451b-8e92-7f6e259965a2">(old ver. Source Code) </a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#8c6b4335-20a1-4f50-9462-5007a125da41">통합 소스 코드</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#20185dfe-70cc-4d0f-a7a4-9b6f83595778">참조 사이트</a></div></nav><h1 id="e49144cb-6ddc-4e3a-a272-aa427b770355" class=""> 1. Web API + Room DB</h1><h2 id="e7184f35-1ae6-4f22-b0be-44310db6e54e" class="">Work Flow</h2><figure id="1714dbfe-8244-4f9b-8504-457f40207e40" class="image"><a href="Composited%20Web+Room+GMap%201714dbfe82444f9b8504457f40207e40/workflow_browExh1.png"><img style="width:2461px" src="Composited%20Web+Room+GMap%201714dbfe82444f9b8504457f40207e40/workflow_browExh1.png"/></a></figure><p id="dd622f2d-4618-4836-9e9c-c3355ac77c98" class="">
</p><h2 id="dc8eb403-e4df-4b89-b099-0cfaa6d9fe7b" class="">Room DB 구성 코드</h2><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css')</style><pre id="9583f931-3f9e-4f78-a79d-32e386298037" class="code"><code><span class="token annotation builtin">@Entity</span><span class="token punctuation">(</span>tableName <span class="token operator">=</span> <span class="token string">"ExhFacility"</span><span class="token punctuation">)</span>
<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">ExhFacility</span> <span class="token punctuation">(</span>
    <span class="token annotation builtin">@PrimaryKey</span><span class="token punctuation">(</span>autoGenerate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">var</span> no<span class="token operator">:</span> Int<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"facName"</span><span class="token punctuation">)</span> <span class="token keyword">var</span> facName<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"addr"</span><span class="token punctuation">)</span> <span class="token keyword">var</span> addr<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"xCoord"</span><span class="token punctuation">)</span> <span class="token keyword">var</span> xCoord<span class="token operator">:</span> Double<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"yCoord"</span><span class="token punctuation">)</span> <span class="token keyword">var</span> yCoord<span class="token operator">:</span> Double<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"homepage"</span><span class="token punctuation">)</span> <span class="token keyword">var</span> homepage<span class="token operator">:</span> String
<span class="token punctuation">)</span>
<span class="token annotation builtin">@Entity</span><span class="token punctuation">(</span>tableName <span class="token operator">=</span> <span class="token string">"Exhibition"</span><span class="token punctuation">)</span>
<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">Exhibition</span><span class="token punctuation">(</span>
    <span class="token annotation builtin">@PrimaryKey</span><span class="token punctuation">(</span>autoGenerate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">var</span> no<span class="token operator">:</span> Int<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"exhName"</span><span class="token punctuation">)</span> <span class="token keyword">var</span> exhName<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"period"</span><span class="token punctuation">)</span> <span class="token keyword">var</span> period<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"website"</span><span class="token punctuation">)</span> <span class="token keyword">var</span> website<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"fees"</span><span class="token punctuation">)</span> <span class="token keyword">var</span> fees<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"closeDay"</span><span class="token punctuation">)</span> <span class="token keyword">var</span> closeDay<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"operHours"</span><span class="token punctuation">)</span> <span class="token keyword">var</span> operHours<span class="token operator">:</span> String
<span class="token punctuation">)</span>
<span class="token annotation builtin">@Entity</span><span class="token punctuation">(</span>tableName <span class="token operator">=</span> <span class="token string">"UserOperated"</span><span class="token punctuation">)</span>
<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">UserOperated</span><span class="token punctuation">(</span>
    <span class="token annotation builtin">@PrimaryKey</span><span class="token punctuation">(</span>autoGenerate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">var</span> no<span class="token operator">:</span> Int<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"userName"</span><span class="token punctuation">)</span> <span class="token keyword">var</span> userName<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"exhGoing"</span><span class="token punctuation">)</span> <span class="token keyword">var</span> exhGoing<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"facFavor"</span><span class="token punctuation">)</span> <span class="token keyword">var</span> facFavor<span class="token operator">:</span> String
<span class="token punctuation">)</span>

<span class="token annotation builtin">@Dao</span>
<span class="token keyword">interface</span> ExhFacilityDao <span class="token punctuation">{</span>
    <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM ExhFacility"</span><span class="token punctuation">)</span>
    <span class="token keyword">fun</span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>ExhFacility<span class="token operator">></span>
    <span class="token annotation builtin">@Insert</span>
    <span class="token keyword">fun</span> <span class="token function">insert</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> ExhFacility<span class="token punctuation">)</span>
    <span class="token annotation builtin">@Update</span>
    <span class="token keyword">fun</span> <span class="token function">update</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> ExhFacility<span class="token punctuation">)</span>
    <span class="token annotation builtin">@Delete</span>
    <span class="token keyword">fun</span> <span class="token function">delete</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> ExhFacility<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token annotation builtin">@Dao</span>
<span class="token keyword">interface</span> ExhibitionDao <span class="token punctuation">{</span>
    <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM Exhibition"</span><span class="token punctuation">)</span>
    <span class="token keyword">fun</span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>Exhibition<span class="token operator">></span>
    <span class="token annotation builtin">@Insert</span>
    <span class="token keyword">fun</span> <span class="token function">insert</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> Exhibition<span class="token punctuation">)</span>
    <span class="token annotation builtin">@Update</span>
    <span class="token keyword">fun</span> <span class="token function">update</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> Exhibition<span class="token punctuation">)</span>
    <span class="token annotation builtin">@Delete</span>
    <span class="token keyword">fun</span> <span class="token function">delete</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> Exhibition<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token annotation builtin">@Dao</span>
<span class="token keyword">interface</span> UserOperatedDao <span class="token punctuation">{</span>
    <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM UserOperated"</span><span class="token punctuation">)</span>
    <span class="token keyword">fun</span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>UserOperated<span class="token operator">></span>
    <span class="token annotation builtin">@Insert</span>
    <span class="token keyword">fun</span> <span class="token function">insert</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> UserOperated<span class="token punctuation">)</span>
    <span class="token annotation builtin">@Update</span>
    <span class="token keyword">fun</span> <span class="token function">update</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> UserOperated<span class="token punctuation">)</span>
    <span class="token annotation builtin">@Delete</span>
    <span class="token keyword">fun</span> <span class="token function">delete</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> UserOperated<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ExhDatabase</span>
<span class="token comment">//   ExhFacility</span>
<span class="token comment">//   Exhibition</span>
<span class="token comment">//   UserOperated</span>
<span class="token annotation builtin">@Database</span><span class="token punctuation">(</span>entities <span class="token operator">=</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span>ExhFacility<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> Exhibition<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> UserOperated<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> version <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">abstract</span> <span class="token keyword">class</span> ExhDatabase<span class="token operator">:</span> <span class="token function">RoomDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">abstract</span> <span class="token keyword">fun</span> <span class="token function">ExhFacilityDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> ExhFacilityDao
    <span class="token keyword">abstract</span> <span class="token keyword">fun</span> <span class="token function">ExhibitionDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> ExhibitionDao
    <span class="token keyword">abstract</span> <span class="token keyword">fun</span> <span class="token function">UserOperatedDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> UserOperatedDao

    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">var</span> INSTANCE<span class="token operator">:</span> ExhDatabase<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>

        <span class="token keyword">fun</span> <span class="token function">getInstance</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span><span class="token operator">:</span> ExhDatabase<span class="token operator">?</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>INSTANCE <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">synchronized</span><span class="token punctuation">(</span>ExhDatabase<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    INSTANCE <span class="token operator">=</span> Room<span class="token punctuation">.</span><span class="token function">databaseBuilder</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>applicationContext<span class="token punctuation">,</span>
                        ExhDatabase<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">,</span> <span class="token string">"rndns_exhibitbrowse.db"</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">allowMainThreadQueries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> INSTANCE
        <span class="token punctuation">}</span>

        <span class="token keyword">fun</span> <span class="token function">destoryInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            INSTANCE <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p id="0b3b5bd4-de7a-49a2-bbe1-136790d1f7e9" class="">
</p><h2 id="07a83e9a-cae2-4ffa-9f18-aa6b1764364d" class="">Main 페이지(Activity) 코드</h2><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css')</style><pre id="4c12aa03-b515-48ce-a79f-1d01c7e5a8a1" class="code"><code><span class="token keyword">class</span> MainActivity<span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">lateinit</span> <span class="token keyword">var</span> checkDB<span class="token operator">:</span> Button
    <span class="token keyword">lateinit</span> <span class="token keyword">var</span> removeDB<span class="token operator">:</span> Button
    <span class="token keyword">var</span> db<span class="token operator">:</span> ExhDatabase<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>layout_main<span class="token punctuation">)</span>

        checkDB <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>checkDB<span class="token punctuation">)</span>
        removeDB <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>removeDB<span class="token punctuation">)</span>

        db <span class="token operator">=</span> ExhDatabase<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"MA10001"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">)</span>

        checkDB<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"MA10001"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token operator">+</span> <span class="token punctuation">(</span>db<span class="token operator">?</span><span class="token punctuation">.</span>isOpen<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">val</span> intent<span class="token operator">:</span> Intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> getWebAPI<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
            <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        removeDB<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"MA10001"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token operator">+</span>db<span class="token punctuation">)</span>
            ExhDatabase<span class="token punctuation">.</span><span class="token function">destoryInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p id="adfb59d7-fedc-406f-8ff5-80411de15055" class="">
</p><h2 id="dbe37d30-149d-4bf1-8f6e-6490048b54fc" class="">handler Room DB on Java</h2><p id="3ecdd78f-b757-42a4-89cb-812d762353ee" class="">Room이 kotlin으로 구현되어 있어서 그런지? Java에서 getInstance()의 context를 매개하는데 오류가 계속 발생했다.</p><p id="4816e22d-1686-4182-960f-4318de43f606" class="">이를 해결하기 위해 Room(kotlin)과 (Java)를 연결하기 위한 클래스(kotlin)를 만들어주었다.</p><p id="0a5bc1f1-eefd-49ec-9c89-4bffff20b2dc" class="">
</p><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css')</style><pre id="1c6efc2c-4498-41a9-93ab-f9c637d6840c" class="code"><code><span class="token keyword">class</span> BridgeOfExhDB <span class="token punctuation">{</span>
    <span class="token keyword">var</span> exhDB<span class="token operator">:</span> ExhDatabase
    <span class="token keyword">constructor</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        exhDB <span class="token operator">=</span> ExhDatabase<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token operator">!!</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">fun</span> <span class="token function">insertExhFacs</span><span class="token punctuation">(</span>exhfacs<span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>TmpExhFac<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"BE10001"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token operator">+</span>exhDB<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"BE10001"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token operator">+</span>exhfacs<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        exhfacs<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span>
            exhDB<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">ExhFacilityDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>
                <span class="token function">ExhFacility</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>no<span class="token punctuation">,</span> it<span class="token punctuation">.</span>facname<span class="token punctuation">,</span> it<span class="token punctuation">.</span>addr<span class="token punctuation">,</span> it<span class="token punctuation">.</span>x<span class="token punctuation">,</span> it<span class="token punctuation">.</span>y<span class="token punctuation">,</span> it<span class="token punctuation">.</span>homepage<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">fun</span> <span class="token function">getExhFacList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>ExhFacility<span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> exhDB<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">ExhFacilityDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">class</span> TmpExhFac <span class="token keyword">constructor</span><span class="token punctuation">(</span>
            <span class="token keyword">var</span> no<span class="token operator">:</span> Int<span class="token punctuation">,</span>
            <span class="token keyword">var</span> facname<span class="token operator">:</span>String<span class="token punctuation">,</span>
            <span class="token keyword">var</span> addr<span class="token operator">:</span> String<span class="token punctuation">,</span>
            <span class="token keyword">var</span> x<span class="token operator">:</span> Double<span class="token punctuation">,</span>
            <span class="token keyword">var</span> y<span class="token operator">:</span> Double<span class="token punctuation">,</span>
            <span class="token keyword">var</span> homepage<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">fun</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">"<span class="token interpolation variable">$no</span> <span class="token interpolation variable">$facname</span> <span class="token interpolation variable">$addr</span> <span class="token interpolation variable">$x</span> <span class="token interpolation variable">$y</span> <span class="token interpolation variable">$homepage</span>"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p id="6f9847ce-c02b-4384-bad9-1e4c78c4ed93" class="">
</p><h2 id="75cfc78c-b162-47b5-b66b-809483d81742" class="">getWebAPI 페이지 코드</h2><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css')</style><pre id="f03fda70-bfba-4e0f-8874-ee17eb05e078" class="code"><code><span class="token keyword">public</span> <span class="token keyword">class</span> getWebAPI <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token punctuation">{</span>
    <span class="token class-name">ListView</span> showList<span class="token punctuation">;</span>
    <span class="token class-name">Button</span> getWebApi<span class="token punctuation">;</span>
    <span class="token class-name">Button</span> addExhFacList<span class="token punctuation">;</span>
    <span class="token class-name">Button</span> showExhFacTable<span class="token punctuation">;</span>

    <span class="token class-name">String</span> API_URL <span class="token operator">=</span> <span class="token string">"http://openapi.seoul.go.kr:8088/sample/xml/culturalSpaceInfo/1/5/"</span><span class="token punctuation">;</span>
    <span class="token class-name">Handler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BridgeOfExhDB</span> db<span class="token punctuation">;</span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BridgeOfExhDB</span><span class="token punctuation">.</span><span class="token class-name">TmpExhFac</span><span class="token punctuation">></span></span> exhFacs<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>layout_getwebapi<span class="token punctuation">)</span><span class="token punctuation">;</span>

        showList <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>showList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        getWebApi <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>getWebApi<span class="token punctuation">)</span><span class="token punctuation">;</span>
        addExhFacList <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>addExhFacList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        showExhFacTable <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>showExhFacTable<span class="token punctuation">)</span><span class="token punctuation">;</span>

        db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BridgeOfExhDB</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// default list를 출력한다</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> defaultlist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ArrayAdapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayAdapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
                <span class="token keyword">this</span><span class="token punctuation">,</span> android<span class="token punctuation">.</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>simple_list_item_1<span class="token punctuation">,</span> defaultlist<span class="token punctuation">)</span><span class="token punctuation">;</span>
        showList<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>adapter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        adapter<span class="token punctuation">.</span><span class="token function">notifyDataSetChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 버튼을 클릭하면, Api data를 list에 출력한다</span>
        getWebApi<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token class-name">OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ConnectThread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectThread</span><span class="token punctuation">(</span>API_URL<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>getWebAPI<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"Check your Internet"</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        addExhFacList<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token class-name">OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                db<span class="token punctuation">.</span><span class="token function">insertExhFacs</span><span class="token punctuation">(</span>exhFacs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"WP10001"</span><span class="token punctuation">,</span> <span class="token string">"[insert exhfaclist to db]"</span><span class="token operator">+</span>exhFacs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 버튼을 클릭하면, Room에 저장된 exhfaclist를 보여준다</span>
        showExhFacTable<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token class-name">OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ExhFacility</span><span class="token punctuation">></span></span> exhfaclist <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">getExhFacList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"WP10001"</span><span class="token punctuation">,</span> <span class="token string">"[get exhfaclist from db]"</span><span class="token operator">+</span>exhfaclist<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">ArrayAdapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ExhFacility</span><span class="token punctuation">></span></span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayAdapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ExhFacility</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
                        getWebAPI<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> android<span class="token punctuation">.</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>simple_list_item_1<span class="token punctuation">,</span> exhfaclist<span class="token punctuation">)</span><span class="token punctuation">;</span>
                showList<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>adapter<span class="token punctuation">)</span><span class="token punctuation">;</span>
                adapter<span class="token punctuation">.</span><span class="token function">notifyDataSetChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">class</span> <span class="token class-name">ConnectThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> url_str<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">ConnectThread</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>url_str <span class="token operator">=</span> url<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">evaluateXPath</span><span class="token punctuation">(</span><span class="token class-name">Document</span> document<span class="token punctuation">,</span> <span class="token class-name">String</span> xpathExpression<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
            <span class="token class-name">XPathFactory</span> xpathFactory <span class="token operator">=</span> <span class="token class-name">XPathFactory</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">XPath</span> xpath <span class="token operator">=</span> xpathFactory<span class="token punctuation">.</span><span class="token function">newXPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// xpathExpression에 해당하는 Node들 가져오기</span>
                <span class="token class-name">XPathExpression</span> expr <span class="token operator">=</span> xpath<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>xpathExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">NodeList</span> nodes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">NodeList</span><span class="token punctuation">)</span> expr<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token class-name">XPathConstants</span><span class="token punctuation">.</span>NODESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nodes<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    values<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>nodes<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNodeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">XPathExpressionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">"Error_10001"</span><span class="token punctuation">,</span> <span class="token string">"XPathExpressionException occurred"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> values<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// URL주소의 document 가져오기</span>
            <span class="token class-name">Document</span> xml <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span>url_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            handler<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token comment">// XPathExpression 작성하기</span>
                        <span class="token class-name">String</span> num_exp <span class="token operator">=</span> <span class="token string">"/culturalSpaceInfo/row/NUM/text()"</span><span class="token punctuation">;</span>
                        <span class="token class-name">String</span> fac_exp <span class="token operator">=</span> <span class="token string">"/culturalSpaceInfo/row/FAC_NAME/text()"</span><span class="token punctuation">;</span>
                        <span class="token class-name">String</span> addr_exp <span class="token operator">=</span> <span class="token string">"/culturalSpaceInfo/row/ADDR/text()"</span><span class="token punctuation">;</span>
                        <span class="token class-name">String</span> x_exp <span class="token operator">=</span> <span class="token string">"/culturalSpaceInfo/row/X_COORD/text()"</span><span class="token punctuation">;</span>
                        <span class="token class-name">String</span> y_exp <span class="token operator">=</span> <span class="token string">"/culturalSpaceInfo/row/Y_COORD/text()"</span><span class="token punctuation">;</span>
                        <span class="token class-name">String</span> hp_exp <span class="token operator">=</span> <span class="token string">"/culturalSpaceInfo/row/HOMEPAGE/text()"</span><span class="token punctuation">;</span>

                        <span class="token comment">// document에서 XPath 가져오기</span>
                        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> nums <span class="token operator">=</span> <span class="token function">evaluateXPath</span><span class="token punctuation">(</span>xml<span class="token punctuation">,</span> num_exp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> facs <span class="token operator">=</span> <span class="token function">evaluateXPath</span><span class="token punctuation">(</span>xml<span class="token punctuation">,</span> fac_exp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> addrs <span class="token operator">=</span> <span class="token function">evaluateXPath</span><span class="token punctuation">(</span>xml<span class="token punctuation">,</span> addr_exp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> xs <span class="token operator">=</span> <span class="token function">evaluateXPath</span><span class="token punctuation">(</span>xml<span class="token punctuation">,</span> x_exp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> ys <span class="token operator">=</span> <span class="token function">evaluateXPath</span><span class="token punctuation">(</span>xml<span class="token punctuation">,</span> y_exp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> homepages <span class="token operator">=</span> <span class="token function">evaluateXPath</span><span class="token punctuation">(</span>xml<span class="token punctuation">,</span> hp_exp<span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">// attrs에 web api에서 가져온 데이터 추가하기</span>
                        exhFacs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BridgeOfExhDB</span><span class="token punctuation">.</span><span class="token class-name">TmpExhFac</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">// 문자열 깨짐 발생시, new String(nums.get(i).getBytes(), "euc-kr")</span>
                            <span class="token class-name">BridgeOfExhDB</span><span class="token punctuation">.</span><span class="token class-name">TmpExhFac</span> tmp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BridgeOfExhDB</span><span class="token punctuation">.</span><span class="token class-name">TmpExhFac</span><span class="token punctuation">(</span>
                                    <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>nums<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    facs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    addrs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>xs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>ys<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    homepages<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"WP10001"</span><span class="token punctuation">,</span> <span class="token string">"[loaded from web api] "</span><span class="token operator">+</span>tmp<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            exhFacs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                        <span class="token comment">// 화면의 list에 출력하기</span>
                        <span class="token class-name">ArrayAdapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BridgeOfExhDB</span><span class="token punctuation">.</span><span class="token class-name">TmpExhFac</span><span class="token punctuation">></span></span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayAdapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BridgeOfExhDB</span><span class="token punctuation">.</span><span class="token class-name">TmpExhFac</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
                                getWebAPI<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> android<span class="token punctuation">.</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>simple_list_item_1<span class="token punctuation">,</span> exhFacs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        showList<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>adapter<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        adapter<span class="token punctuation">.</span><span class="token function">notifyDataSetChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">"Error_10001"</span><span class="token punctuation">,</span> <span class="token string">"XPath failed"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token class-name">Document</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token class-name">String</span> url_str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Document</span> outputDoc <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// HTTP로 URL주소 연결하기</span>
                <span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">URL</span><span class="token punctuation">(</span>url_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">HttpURLConnection</span> conn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpURLConnection</span><span class="token punctuation">)</span>url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    conn<span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 10s이상이면 Timeout</span>
                    conn<span class="token punctuation">.</span><span class="token function">setRequestMethod</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// utf-8 인코딩으로 읽어오기</span>
                    <span class="token class-name">InputStreamReader</span> isr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>conn<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">DocumentBuilderFactory</span> dbFactory <span class="token operator">=</span> <span class="token class-name">DocumentBuilderFactory</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">DocumentBuilder</span> builder <span class="token operator">=</span> dbFactory<span class="token punctuation">.</span><span class="token function">newDocumentBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    outputDoc <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputSource</span><span class="token punctuation">(</span>isr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    conn<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> <span class="token operator">|</span> <span class="token class-name">SAXException</span> <span class="token operator">|</span> <span class="token class-name">ParserConfigurationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">"Error_10001"</span><span class="token punctuation">,</span> <span class="token string">"Exception in processing response"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> outputDoc<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p id="f1bdc55a-aa99-492c-92d8-eea242653fe8" class="">
</p><h2 id="7525170d-f119-43d7-ba8b-46989f62086f" class="">추가 설정 코드</h2><p id="b9fbd4ff-c0ff-448c-91ff-b18e84933f21" class="">Web API 데이터를 가져오기 위해 AndroidManifest.xml에 다음을 추가하였다.</p><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css')</style><pre id="a5f7163a-52df-469f-b2cc-1e20cfa791d8" class="code"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>android.permission.INTERNET<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>application</span>
        <span class="token attr-name"><span class="token namespace">android:</span>usesCleartextTraffic</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
		<span class="token comment">&lt;!-- &lt;activity>들 --></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>application</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifest</span><span class="token punctuation">></span></span></code></pre><p id="67831714-5c22-4f04-8ce8-27a58755f692" class="">
</p><p id="09594bd8-47df-4639-ac25-f7e3ac2960ee" class="">Room (kotlin)을 사용하기 위해 build.gradle (Module)에 다음을 추가하였다.</p><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css')</style><pre id="17eaf6e5-4d2f-4d2f-8e06-48739732c2ff" class="code"><code>plugins {
	id 'kotlin-kapt'
}

dependencies {
	def room_version = "2.2.6"
  implementation "androidx.room:room-runtime:$room_version"
  annotationProcessor "androidx.room:room-compiler:$room_version"
  annotationProcessor "android.arch.persistence.room:compiler:$room_version"
  kapt "android.arch.persistence.room:compiler:$room_version"
}</code></pre><p id="f0389c27-21df-425f-9703-02ee70372184" class="">
</p><p id="21d5bc07-0258-4254-ad40-21c3354622b8" class="">
</p><h1 id="a332dcd6-abf1-4767-b638-24cd988a94ee" class=""> 2. Web + Room + Map</h1><h2 id="e297939e-219b-465e-95d0-7c9b39e9c160" class="">[Google Map] 현위치 가져오기</h2><figure id="f8c6a503-056e-4142-9e16-45b32b947284"><a href="https://developers.google.com/maps/documentation/android-sdk/overview" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Overview | Maps SDK for Android | Google Developers</div><div class="bookmark-description">&quot;type&quot;: &quot;thumb-down&quot;, &quot;id&quot;: &quot;missingTheInformationINeed&quot;, &quot;label&quot;:&quot;Missing the information I need&quot; },{ &quot;type&quot;: &quot;thumb-down&quot;, &quot;id&quot;: &quot;tooComplicatedTooManySteps&quot;, &quot;label&quot;:&quot;Too complicated / too many steps&quot; },{ &quot;type&quot;: &quot;thumb-down&quot;, &quot;id&quot;: &quot;outOfDate&quot;, &quot;label&quot;:&quot;Out of date&quot; },{ &quot;type&quot;: &quot;thumb-down&quot;, &quot;id&quot;: &quot;samplesCodeIssue&quot;, &quot;label&quot;:&quot;Samples/Code issue&quot; },{ &quot;type&quot;: &quot;thumb-down&quot;, &quot;id&quot;: &quot;otherDown&quot;, &quot;label&quot;:&quot;Other&quot; }] [{ &quot;type&quot;: &quot;thumb-up&quot;, &quot;id&quot;: &quot;easyToUnderstand&quot;, &quot;label&quot;:&quot;Easy to understand&quot; },{ &quot;type&quot;: &quot;thumb-up&quot;, &quot;id&quot;: &quot;solvedMyProblem&quot;, &quot;label&quot;:&quot;Solved my problem&quot; },{ &quot;type&quot;: &quot;thumb-up&quot;, &quot;id&quot;: &quot;otherUp&quot;, &quot;label&quot;:&quot;Other&quot; }] Before you begin: Before you start using the Maps SDK for Android, you need a project with a billing account and the Maps SDK for Android enabled.</div></div><div class="bookmark-href"><img src="https://www.gstatic.com/devrel-devsite/prod/vbd904f2719533e871e3800dda1bebc56aa0bc95c3c9d01c4d7cebcf129bdf26c/developers/images/favicon.png" class="icon bookmark-icon"/>https://developers.google.com/maps/documentation/android-sdk/overview</div></div><img src="https://www.gstatic.com/devrel-devsite/prod/vbd904f2719533e871e3800dda1bebc56aa0bc95c3c9d01c4d7cebcf129bdf26c/developers/images/opengraph/white.png" class="bookmark-image"/></a></figure><p id="7d0a4236-6a70-4a36-8d90-e6a4090ff829" class="">
</p><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css')</style><pre id="a1309e04-8341-4ea2-bf32-092cf4fc9f15" class="code"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapsActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token keyword">implements</span> <span class="token class-name">OnMapReadyCallback</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> TAG <span class="token operator">=</span> <span class="token class-name">MapsActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">GoogleMap</span> map<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">CameraPosition</span> cameraPosition<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">PlacesClient</span> placesClient<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">FusedLocationProviderClient</span> fusedLocationProviderClient<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LatLng</span> defaultLocation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">33.8523341</span><span class="token punctuation">,</span> <span class="token number">151.2106085</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEFAULT_ZOOM <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> PERMISSIONS_REQUEST_ACCESS_FINE_LOCATION <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> locationPermissionGranted<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Location</span> lastKnownLocation<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> KEY_CAMERA_POSITION <span class="token operator">=</span> <span class="token string">"camera_position"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> KEY_LOCATION <span class="token operator">=</span> <span class="token string">"location"</span><span class="token punctuation">;</span>

		<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>savedInstanceState <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lastKnownLocation <span class="token operator">=</span> savedInstanceState<span class="token punctuation">.</span><span class="token function">getParcelable</span><span class="token punctuation">(</span>KEY_LOCATION<span class="token punctuation">)</span><span class="token punctuation">;</span>
            cameraPosition <span class="token operator">=</span> savedInstanceState<span class="token punctuation">.</span><span class="token function">getParcelable</span><span class="token punctuation">(</span>KEY_CAMERA_POSITION<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"[saved_maps_data] "</span><span class="token operator">+</span>lastKnownLocation<span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span>cameraPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_maps<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Places</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>google_maps_key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        placesClient <span class="token operator">=</span> <span class="token class-name">Places</span><span class="token punctuation">.</span><span class="token function">createClient</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fusedLocationProviderClient <span class="token operator">=</span> <span class="token class-name">LocationServices</span><span class="token punctuation">.</span><span class="token function">getFusedLocationProviderClient</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">SupportMapFragment</span> mapFragment <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SupportMapFragment</span><span class="token punctuation">)</span> <span class="token function">getSupportFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">findFragmentById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mapFragment<span class="token punctuation">.</span><span class="token function">getMapAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> outState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            outState<span class="token punctuation">.</span><span class="token function">putParcelable</span><span class="token punctuation">(</span>KEY_CAMERA_POSITION<span class="token punctuation">,</span> map<span class="token punctuation">.</span><span class="token function">getCameraPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            outState<span class="token punctuation">.</span><span class="token function">putParcelable</span><span class="token punctuation">(</span>KEY_LOCATION<span class="token punctuation">,</span> lastKnownLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"[saving maps_data] "</span><span class="token operator">+</span>lastKnownLocation<span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span>cameraPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span>outState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

		<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMapReady</span><span class="token punctuation">(</span><span class="token class-name">GoogleMap</span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> map<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">setInfoWindowAdapter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GoogleMap</span><span class="token punctuation">.</span><span class="token class-name">InfoWindowAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">getInfoWindow</span><span class="token punctuation">(</span><span class="token class-name">Marker</span> arg0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">getInfoContents</span><span class="token punctuation">(</span><span class="token class-name">Marker</span> marker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">View</span> infoWindow <span class="token operator">=</span> <span class="token function">getLayoutInflater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>custom_info_contents<span class="token punctuation">,</span>
                        <span class="token punctuation">(</span><span class="token class-name">FrameLayout</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>map<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">TextView</span> title <span class="token operator">=</span> infoWindow<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
                title<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>marker<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">TextView</span> snippet <span class="token operator">=</span> infoWindow<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>snippet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                snippet<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>marker<span class="token punctuation">.</span><span class="token function">getSnippet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"[UI info_window] "</span><span class="token operator">+</span>title<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span>snippet<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> infoWindow<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">getLocationPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">updateLocationUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getDeviceLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">getDeviceLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>locationPermissionGranted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Task</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Location</span><span class="token punctuation">></span></span> locationResult <span class="token operator">=</span> fusedLocationProviderClient<span class="token punctuation">.</span><span class="token function">getLastLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                locationResult<span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OnCompleteListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Location</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Task</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Location</span><span class="token punctuation">></span></span> task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">isSuccessful</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">// Set the map's camera position to the current location of the device.</span>
                            lastKnownLocation <span class="token operator">=</span> task<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>lastKnownLocation <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                map<span class="token punctuation">.</span><span class="token function">moveCamera</span><span class="token punctuation">(</span><span class="token class-name">CameraUpdateFactory</span><span class="token punctuation">.</span><span class="token function">newLatLngZoom</span><span class="token punctuation">(</span>
                                        <span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span>lastKnownLocation<span class="token punctuation">.</span><span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                lastKnownLocation<span class="token punctuation">.</span><span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DEFAULT_ZOOM<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"[set last_known_loc] "</span><span class="token operator">+</span>lastKnownLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Current location is null. Using defaults."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Exception: %s"</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            map<span class="token punctuation">.</span><span class="token function">moveCamera</span><span class="token punctuation">(</span><span class="token class-name">CameraUpdateFactory</span>
                                    <span class="token punctuation">.</span><span class="token function">newLatLngZoom</span><span class="token punctuation">(</span>defaultLocation<span class="token punctuation">,</span> DEFAULT_ZOOM<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            map<span class="token punctuation">.</span><span class="token function">getUiSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMyLocationButtonEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SecurityException</span> e<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">"Exception: %s"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">getLocationPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ContextCompat</span><span class="token punctuation">.</span><span class="token function">checkSelfPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                android<span class="token punctuation">.</span><span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span>ACCESS_FINE_LOCATION<span class="token punctuation">)</span>
                <span class="token operator">==</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span>PERMISSION_GRANTED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            locationPermissionGranted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">ActivityCompat</span><span class="token punctuation">.</span><span class="token function">requestPermissions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>android<span class="token punctuation">.</span><span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span>ACCESS_FINE_LOCATION<span class="token punctuation">}</span><span class="token punctuation">,</span>
                    PERMISSIONS_REQUEST_ACCESS_FINE_LOCATION<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRequestPermissionsResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> requestCode<span class="token punctuation">,</span>
                                           <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> permissions<span class="token punctuation">,</span>
                                           <span class="token annotation punctuation">@NonNull</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> grantResults<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        locationPermissionGranted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>requestCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> PERMISSIONS_REQUEST_ACCESS_FINE_LOCATION<span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>grantResults<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span>
                        <span class="token operator">&amp;&amp;</span> grantResults<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span>PERMISSION_GRANTED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    locationPermissionGranted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">updateLocationUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

		<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updateLocationUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>locationPermissionGranted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                map<span class="token punctuation">.</span><span class="token function">setMyLocationEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                map<span class="token punctuation">.</span><span class="token function">getUiSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMyLocationButtonEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                map<span class="token punctuation">.</span><span class="token function">setMyLocationEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                map<span class="token punctuation">.</span><span class="token function">getUiSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMyLocationButtonEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                lastKnownLocation <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token function">getLocationPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SecurityException</span> e<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">"Exception: %s"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css')</style><pre id="b6e55930-9823-40e4-9e95-7f9b71b53ce4" class="code"><code>dependencies {
		implementation 'com.google.android.gms:play-services-maps:17.0.0'
    implementation 'com.google.android.gms:play-services-location:17.1.0'
    implementation 'com.google.android.libraries.places:places:2.4.0'
}</code></pre><p id="e7265694-4577-4d3e-8813-b4a2fadbf540" class="">
</p><h2 id="602a52d6-2246-44f1-bdb2-f4404a962a22" class="">[Google Map] 지도 위에 마크찍기</h2><figure id="f75a1849-b2df-49b7-8aec-24f96629f4c2"><a href="https://github.com/googlemaps/android-samples/blob/master/ApiDemos/java/app/src/gms/java/com/example/mapdemo/BasicMapDemoActivity.java" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">googlemaps/android-samples</div><div class="bookmark-description">Samples demonstrating how to use Maps SDK for Android - googlemaps/android-samples</div></div><div class="bookmark-href"><img src="https://github.com/favicon.ico" class="icon bookmark-icon"/>https://github.com/googlemaps/android-samples/blob/master/ApiDemos/java/app/src/gms/java/com/example/mapdemo/BasicMapDemoActivity.java</div></div><img src="https://repository-images.githubusercontent.com/34364279/f9a19c80-499e-11ea-9566-b8c9218dc23c" class="bookmark-image"/></a></figure><p id="bdf57cc1-92e3-442a-a231-bbe1262cab5b" class="">
</p><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css')</style><pre id="ae494929-f908-4429-8edf-53938d2fe4a1" class="code"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMapReady</span><span class="token punctuation">(</span><span class="token class-name">GoogleMap</span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> map<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span><span class="token number">37.572426</span><span class="token punctuation">,</span> <span class="token number">126.975632</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"세종문화회관"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">snippet</span><span class="token punctuation">(</span><span class="token string">"서울특별시 종로구 세종대로 175 (세종로) 세종문화회관 (우)03172"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">setInfoWindowAdapter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GoogleMap</span><span class="token punctuation">.</span><span class="token class-name">InfoWindowAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">getInfoWindow</span><span class="token punctuation">(</span><span class="token class-name">Marker</span> arg0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">getInfoContents</span><span class="token punctuation">(</span><span class="token class-name">Marker</span> marker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">View</span> infoWindow <span class="token operator">=</span> <span class="token function">getLayoutInflater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>custom_info_contents<span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token class-name">FrameLayout</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>map<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">TextView</span> title <span class="token operator">=</span> infoWindow<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
            title<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>marker<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">TextView</span> snippet <span class="token operator">=</span> infoWindow<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>snippet<span class="token punctuation">)</span><span class="token punctuation">;</span>
            snippet<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>marker<span class="token punctuation">.</span><span class="token function">getSnippet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"[UI info_window] "</span><span class="token operator">+</span>title<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span>snippet<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> infoWindow<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">getLocationPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">updateLocationUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getDeviceLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p id="bb181728-098e-436a-803a-8191c9b6d336" class="">
</p><h2 id="c1b32757-a157-451b-8e92-7f6e259965a2" class="">(old ver. Source Code) </h2><figure id="96560531-353c-4a1c-99d6-09f703dd6047"><div class="source"><a href="Composited%20Web+Room+GMap%201714dbfe82444f9b8504457f40207e40/webdbmap.zip">https://s3-us-west-2.amazonaws.com/secure.notion-static.com/23b1f895-8d75-483e-8987-42d8177c40a1/webdbmap.zip</a></div></figure><p id="ddbdbe42-2f97-44fa-b770-fc9a31a2c00e" class="">
</p><figure id="65a41c27-5b85-42c8-b528-6fb1822dd0e8" class="image"><a href="Composited%20Web+Room+GMap%201714dbfe82444f9b8504457f40207e40/gmap_cmps_workflow.png"><img style="width:2334px" src="Composited%20Web+Room+GMap%201714dbfe82444f9b8504457f40207e40/gmap_cmps_workflow.png"/></a></figure><p id="a639758f-edbb-49f6-b512-4b50540f9394" class="">인터넷과 위치를 켜둔 후에, 위의 작업흐름과 같이 테스트를 진행한다.</p><p id="8633daad-8615-4019-970c-a7c983c655a3" class="">2- 화면을 통해 Web에서의 Open API를 통해 데이터를 가져온 것을 확인한다.</p><p id="fbf71381-538a-451e-a805-f89ed99d2973" class="">4- 화면을 통해 Room DB의 ExhFac테이블에 저장된 데이터를 확인한다.</p><p id="20e63a10-0a46-4348-b871-064caa816007" class="">5- DB에 저장된 데이터를 Google Map위에 마크한 것을 확인한다.</p><p id="567d7364-8772-4753-94be-4fd18d35f924" class="">6- 현위치로 Google Map 카메라가 조정된 것을 확인한다.</p><p id="6f9b33a6-121d-4724-973d-68668ff0f6f4" class="">
</p><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css')</style><pre id="cbc54c9c-c0b6-442f-a342-fc7e69f4bd2c" class="code"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapsActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token keyword">implements</span> <span class="token class-name">OnMapReadyCallback</span><span class="token punctuation">,</span> <span class="token class-name">GoogleMap</span><span class="token punctuation">.</span><span class="token class-name">OnPoiClickListener</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> TAG <span class="token operator">=</span> <span class="token class-name">MapsActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">GoogleMap</span> map<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">CameraPosition</span> cameraPosition<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">PlacesClient</span> placesClient<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">FusedLocationProviderClient</span> fusedLocationProviderClient<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LatLng</span> defaultLocation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">33.8523341</span><span class="token punctuation">,</span> <span class="token number">151.2106085</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEFAULT_ZOOM <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> PERMISSIONS_REQUEST_ACCESS_FINE_LOCATION <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> locationPermissionGranted<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Location</span> lastKnownLocation<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> KEY_CAMERA_POSITION <span class="token operator">=</span> <span class="token string">"camera_position"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> KEY_LOCATION <span class="token operator">=</span> <span class="token string">"location"</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>savedInstanceState <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lastKnownLocation <span class="token operator">=</span> savedInstanceState<span class="token punctuation">.</span><span class="token function">getParcelable</span><span class="token punctuation">(</span>KEY_LOCATION<span class="token punctuation">)</span><span class="token punctuation">;</span>
            cameraPosition <span class="token operator">=</span> savedInstanceState<span class="token punctuation">.</span><span class="token function">getParcelable</span><span class="token punctuation">(</span>KEY_CAMERA_POSITION<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"[saved_maps_data] "</span><span class="token operator">+</span>lastKnownLocation<span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span>cameraPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_maps<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Places</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>google_maps_key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        placesClient <span class="token operator">=</span> <span class="token class-name">Places</span><span class="token punctuation">.</span><span class="token function">createClient</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fusedLocationProviderClient <span class="token operator">=</span> <span class="token class-name">LocationServices</span><span class="token punctuation">.</span><span class="token function">getFusedLocationProviderClient</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">SupportMapFragment</span> mapFragment <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SupportMapFragment</span><span class="token punctuation">)</span> <span class="token function">getSupportFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">findFragmentById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mapFragment<span class="token punctuation">.</span><span class="token function">getMapAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> outState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            outState<span class="token punctuation">.</span><span class="token function">putParcelable</span><span class="token punctuation">(</span>KEY_CAMERA_POSITION<span class="token punctuation">,</span> map<span class="token punctuation">.</span><span class="token function">getCameraPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            outState<span class="token punctuation">.</span><span class="token function">putParcelable</span><span class="token punctuation">(</span>KEY_LOCATION<span class="token punctuation">,</span> lastKnownLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"[saving maps_data] "</span><span class="token operator">+</span>lastKnownLocation<span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span>cameraPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span>outState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequiresApi</span><span class="token punctuation">(</span>api <span class="token operator">=</span> <span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span><span class="token class-name">N</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMapReady</span><span class="token punctuation">(</span><span class="token class-name">GoogleMap</span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> map<span class="token punctuation">;</span>

        <span class="token comment">// DB로 부터 데이터 가져와 찍기</span>
        <span class="token class-name">BridgeOfExhDB</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BridgeOfExhDB</span><span class="token punctuation">(</span><span class="token class-name">MapsActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ExhFacility</span><span class="token punctuation">></span></span> exhfaclist <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">getExhFacList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        exhfaclist<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>element <span class="token operator">-></span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">getXCoord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> element<span class="token punctuation">.</span><span class="token function">getYCoord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">getFacName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">snippet</span><span class="token punctuation">(</span><span class="token string">" [주소]"</span><span class="token operator">+</span>element<span class="token punctuation">.</span><span class="token function">getAddr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" [웹사이트]"</span><span class="token operator">+</span>element<span class="token punctuation">.</span><span class="token function">getHomepage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">setInfoWindowAdapter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GoogleMap</span><span class="token punctuation">.</span><span class="token class-name">InfoWindowAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">getInfoWindow</span><span class="token punctuation">(</span><span class="token class-name">Marker</span> arg0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">getInfoContents</span><span class="token punctuation">(</span><span class="token class-name">Marker</span> marker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">View</span> infoWindow <span class="token operator">=</span> <span class="token function">getLayoutInflater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>custom_info_contents<span class="token punctuation">,</span>
                        <span class="token punctuation">(</span><span class="token class-name">FrameLayout</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>map<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">TextView</span> title <span class="token operator">=</span> infoWindow<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
                title<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>marker<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">TextView</span> snippet <span class="token operator">=</span> infoWindow<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>snippet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                snippet<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>marker<span class="token punctuation">.</span><span class="token function">getSnippet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"[UI info_window] "</span><span class="token operator">+</span>title<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span>snippet<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> infoWindow<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">getLocationPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">updateLocationUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getDeviceLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">getDeviceLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>locationPermissionGranted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Task</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Location</span><span class="token punctuation">></span></span> locationResult <span class="token operator">=</span> fusedLocationProviderClient<span class="token punctuation">.</span><span class="token function">getLastLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                locationResult<span class="token punctuation">.</span><span class="token function">addOnCompleteListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OnCompleteListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Location</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Task</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Location</span><span class="token punctuation">></span></span> task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">isSuccessful</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">// Set the map's camera position to the current location of the device.</span>
                            lastKnownLocation <span class="token operator">=</span> task<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>lastKnownLocation <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                map<span class="token punctuation">.</span><span class="token function">moveCamera</span><span class="token punctuation">(</span><span class="token class-name">CameraUpdateFactory</span><span class="token punctuation">.</span><span class="token function">newLatLngZoom</span><span class="token punctuation">(</span>
                                        <span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span>lastKnownLocation<span class="token punctuation">.</span><span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                lastKnownLocation<span class="token punctuation">.</span><span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DEFAULT_ZOOM<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"[set last_known_loc] "</span><span class="token operator">+</span>lastKnownLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Current location is null. Using defaults."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Exception: %s"</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            map<span class="token punctuation">.</span><span class="token function">moveCamera</span><span class="token punctuation">(</span><span class="token class-name">CameraUpdateFactory</span>
                                    <span class="token punctuation">.</span><span class="token function">newLatLngZoom</span><span class="token punctuation">(</span>defaultLocation<span class="token punctuation">,</span> DEFAULT_ZOOM<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            map<span class="token punctuation">.</span><span class="token function">getUiSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMyLocationButtonEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SecurityException</span> e<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">"Exception: %s"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">getLocationPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ContextCompat</span><span class="token punctuation">.</span><span class="token function">checkSelfPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                android<span class="token punctuation">.</span><span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span>ACCESS_FINE_LOCATION<span class="token punctuation">)</span>
                <span class="token operator">==</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span>PERMISSION_GRANTED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            locationPermissionGranted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">ActivityCompat</span><span class="token punctuation">.</span><span class="token function">requestPermissions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>android<span class="token punctuation">.</span><span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span>ACCESS_FINE_LOCATION<span class="token punctuation">}</span><span class="token punctuation">,</span>
                    PERMISSIONS_REQUEST_ACCESS_FINE_LOCATION<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRequestPermissionsResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> requestCode<span class="token punctuation">,</span>
                                           <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> permissions<span class="token punctuation">,</span>
                                           <span class="token annotation punctuation">@NonNull</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> grantResults<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        locationPermissionGranted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>requestCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> PERMISSIONS_REQUEST_ACCESS_FINE_LOCATION<span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>grantResults<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span>
                        <span class="token operator">&amp;&amp;</span> grantResults<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span>PERMISSION_GRANTED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    locationPermissionGranted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">updateLocationUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updateLocationUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>locationPermissionGranted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                map<span class="token punctuation">.</span><span class="token function">setMyLocationEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                map<span class="token punctuation">.</span><span class="token function">getUiSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMyLocationButtonEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                map<span class="token punctuation">.</span><span class="token function">setMyLocationEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                map<span class="token punctuation">.</span><span class="token function">getUiSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMyLocationButtonEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                lastKnownLocation <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token function">getLocationPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SecurityException</span> e<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">"Exception: %s"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPoiClick</span><span class="token punctuation">(</span><span class="token class-name">PointOfInterest</span> pointOfInterest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"Clicked: "</span><span class="token operator">+</span>pointOfInterest<span class="token punctuation">.</span>name
                <span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span>pointOfInterest<span class="token punctuation">.</span>placeId<span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p id="bb5d3d93-9bd0-4e31-abf2-76dc30900632" class="">
</p><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css')</style><pre id="d77903f1-d1e0-41cd-998d-e1ab9e1fa27b" class="code"><code>dependencies {
    implementation 'com.google.android.gms:play-services-maps:17.0.0'
    implementation 'androidx.constraintlayout:constraintlayout:2.0.4'
    implementation 'com.google.android.gms:play-services-location:17.1.0'
    implementation 'com.google.android.libraries.places:places:2.4.0'

    def room_version = "2.2.6"
    implementation "androidx.room:room-runtime:$room_version"
    annotationProcessor "androidx.room:room-compiler:$room_version"
    annotationProcessor "android.arch.persistence.room:compiler:$room_version"
    kapt "android.arch.persistence.room:compiler:$room_version"
}</code></pre><p id="698e28d5-3d9c-409d-a36f-f170f8b84e46" class="">
</p><h2 id="8c6b4335-20a1-4f50-9462-5007a125da41" class="">통합 소스 코드</h2><figure id="7ff23b6a-5a0c-4405-aa14-05577049414e"><div class="source"><a href="Composited%20Web+Room+GMap%201714dbfe82444f9b8504457f40207e40/cmps_webdbmap.zip">https://s3-us-west-2.amazonaws.com/secure.notion-static.com/13194cca-38b6-4133-96b0-ad4307d43c39/cmps_webdbmap.zip</a></div></figure><p id="f06cbc1d-7736-4eaf-9452-17e6d8eb5f41" class="">
</p><figure id="c222a0c5-6f42-4ad7-8635-55004b7e4e1e" class="image"><a href="Composited%20Web+Room+GMap%201714dbfe82444f9b8504457f40207e40/Screenshot_20210224-223956_Browse_Exhibition.jpg"><img style="width:336px" src="Composited%20Web+Room+GMap%201714dbfe82444f9b8504457f40207e40/Screenshot_20210224-223956_Browse_Exhibition.jpg"/></a></figure><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css')</style><pre id="7fe019c4-6b17-42e9-88d6-bffb5dff220c" class="code"><code>class MapsActivity : AppCompatActivity(), OnMapReadyCallback, OnPoiClickListener {
    private val TAG = MapsActivity::class.java.simpleName
    private val DEFAULT_ZOOM = 15
    private val PERMISSIONS_REQUEST_ACCESS_FINE_LOCATION = 1
    private val KEY_CAMERA_POSITION = "camera_position"
    private val KEY_LOCATION = "location"

    var API_URL = "http://openapi.seoul.go.kr:8088/sample/xml/culturalSpaceInfo/1/5/"
    lateinit var thread: ConnectThread

    private var map: GoogleMap? = null
    private var cameraPosition: CameraPosition? = null
    private var placesClient: PlacesClient? = null
    private var fusedLocationProviderClient: FusedLocationProviderClient? = null
    private val defaultLocation = LatLng(-33.8523341, 151.2106085)
    private var locationPermissionGranted = false
    private var lastKnownLocation: Location? = null

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        if (savedInstanceState != null) {
            lastKnownLocation = savedInstanceState.getParcelable(KEY_LOCATION)
            cameraPosition = savedInstanceState.getParcelable(KEY_CAMERA_POSITION)
            Log.e(TAG, "[saved_maps_data] $lastKnownLocation $cameraPosition")
        }
        setContentView(R.layout.activity_maps)

        try {
            thread = ConnectThread(API_URL, this)
            thread.start()
        } catch (e: java.lang.Exception) {
            Toast.makeText(this, "Check your Internet", Toast.LENGTH_LONG)
        }

        Places.initialize(applicationContext, R.string.google_maps_key.toString())
        placesClient = Places.createClient(this)
        fusedLocationProviderClient = LocationServices.getFusedLocationProviderClient(this)

        val mapFragment = supportFragmentManager
                .findFragmentById(R.id.map) as SupportMapFragment?
        mapFragment?.getMapAsync(this)
    }

    override fun onSaveInstanceState(outState: Bundle) {
        if (map != null) {
            outState.putParcelable(KEY_CAMERA_POSITION, map!!.cameraPosition)
            outState.putParcelable(KEY_LOCATION, lastKnownLocation)
            Log.e(TAG, "[saving maps_data] $lastKnownLocation $cameraPosition")
        }
        super.onSaveInstanceState(outState)
    }

    @RequiresApi(api = Build.VERSION_CODES.N)
    override fun onMapReady(map: GoogleMap) {
        this.map = map

        // DB로 부터 데이터 가져와 찍기
        val db: ExhDatabase? = ExhDatabase.getInstance(this)
        val exhfaclist = db?.ExhFacilityDao()?.getAll()
        exhfaclist?.forEach(Consumer { (_, facName, addr, xCoord, yCoord, homepage) ->
            this.map!!.addMarker(MarkerOptions()
                    .position(LatLng(xCoord, yCoord))
                    .title(facName)
                    .snippet(" [주소]$addr [웹사이트]$homepage")
            )
        })

        this.map!!.setInfoWindowAdapter(object : InfoWindowAdapter {
            override fun getInfoWindow(arg0: Marker): View? {
                return null
            }

            override fun getInfoContents(marker: Marker): View {
                val infoWindow = layoutInflater.inflate(R.layout.custom_info_contents,
                        findViewById<View>(R.id.map) as FrameLayout, false)
                val title = infoWindow.findViewById<TextView>(R.id.title)
                title.text = marker.title
                val snippet = infoWindow.findViewById<TextView>(R.id.snippet)
                snippet.text = marker.snippet
                Log.e(TAG, "[UI info_window] " + title.text + " " + snippet.text)
                return infoWindow
            }
        })
        locationPermission()
        updateLocationUI()
        deviceLocation()
    }

    // Set the map's camera position to the current location of the device.
    private fun deviceLocation() {
        try {
            if (locationPermissionGranted) {
                val locationResult = fusedLocationProviderClient!!.lastLocation
                locationResult.addOnCompleteListener(this) { task ->
                    if (task.isSuccessful) {
                        // Set the map's camera position to the current location of the device.
                        lastKnownLocation = task.result
                        if (lastKnownLocation != null) {
                            map!!.moveCamera(CameraUpdateFactory.newLatLngZoom(
                                    LatLng(lastKnownLocation!!.latitude,
                                            lastKnownLocation!!.longitude), DEFAULT_ZOOM.toFloat()))
                        }
                        Log.e(TAG, "[set last_known_loc] $lastKnownLocation")
                    } else {
                        Log.e(TAG, "Current location is null. Using defaults.")
                        Log.e(TAG, "Exception: %s", task.exception)
                        map!!.moveCamera(CameraUpdateFactory
                                .newLatLngZoom(defaultLocation, DEFAULT_ZOOM.toFloat()))
                        map!!.uiSettings.isMyLocationButtonEnabled = false
                    }
                }
            }
        } catch (e: SecurityException) {
            Log.e("Exception: %s", e.message, e)
        }
    }

    private fun locationPermission() {
        if (ContextCompat.checkSelfPermission(this.applicationContext, Manifest.permission.ACCESS_FINE_LOCATION)
                == PackageManager.PERMISSION_GRANTED) {
            locationPermissionGranted = true
        } else {
            ActivityCompat.requestPermissions(this, arrayOf(Manifest.permission.ACCESS_FINE_LOCATION),
                    PERMISSIONS_REQUEST_ACCESS_FINE_LOCATION)
        }
    }

    override fun onRequestPermissionsResult(requestCode: Int, permissions: Array<String>, grantResults: IntArray) {
        locationPermissionGranted = false
        when (requestCode) {
            PERMISSIONS_REQUEST_ACCESS_FINE_LOCATION -> {
                if (grantResults.size > 0
                        && grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                    locationPermissionGranted = true
                }
            }
        }
        updateLocationUI()
    }

    private fun updateLocationUI() {
        if (map == null) {
            return
        }
        try {
            if (locationPermissionGranted) {
                map!!.isMyLocationEnabled = true
                map!!.uiSettings.isMyLocationButtonEnabled = true
            } else {
                map!!.isMyLocationEnabled = false
                map!!.uiSettings.isMyLocationButtonEnabled = false
                lastKnownLocation = null
                locationPermission()
            }
        } catch (e: SecurityException) {
            Log.e("Exception: %s", e.message!!)
        }
    }

    override fun onPoiClick(pointOfInterest: PointOfInterest) {
        Toast.makeText(this, "Clicked: ${pointOfInterest.name} ${pointOfInterest.placeId}", Toast.LENGTH_LONG).show()
    }

    public class ConnectThread(var url_str: String, val context: Context) : Thread() {
        private val TAG = ConnectThread::class.java.simpleName
        var handler = Handler()
        lateinit var db: ExhDatabase

        @Throws(Exception::class)
        fun evaluateXPath(document: Document?, xpathExpression: String?): ArrayList<String> {
            val xpathFactory = XPathFactory.newInstance()
            val xpath = xpathFactory.newXPath()
            val values = ArrayList<String>()
            try {
                // xpathExpression에 해당하는 Node들 가져오기
                val expr = xpath.compile(xpathExpression)
                val nodes = expr.evaluate(document, XPathConstants.NODESET) as NodeList
                for (i in 0 until nodes.length) {
                    values.add(nodes.item(i).nodeValue)
                }
            } catch (e: XPathExpressionException) {
                Log.e(TAG, "XPathExpressionException occurred")
            }
            return values
        }

        override fun run() {
            // URL주소의 document 가져오기
            val xml = request(url_str)
            handler.post(Runnable {
                try {
                    // XPathExpression 작성하기
                    val num_exp = "/culturalSpaceInfo/row/NUM/text()"
                    val fac_exp = "/culturalSpaceInfo/row/FAC_NAME/text()"
                    val addr_exp = "/culturalSpaceInfo/row/ADDR/text()"
                    val x_exp = "/culturalSpaceInfo/row/X_COORD/text()"
                    val y_exp = "/culturalSpaceInfo/row/Y_COORD/text()"
                    val hp_exp = "/culturalSpaceInfo/row/HOMEPAGE/text()"

                    // document에서 XPath 가져오기
                    val nums = evaluateXPath(xml, num_exp)
                    val facs = evaluateXPath(xml, fac_exp)
                    val addrs = evaluateXPath(xml, addr_exp)
                    val xs = evaluateXPath(xml, x_exp)
                    val ys = evaluateXPath(xml, y_exp)
                    val homepages = evaluateXPath(xml, hp_exp)

                    db = ExhDatabase.getInstance(context)!!
                    Log.e(TAG, ""+db.isOpen)
                    for (i in nums.indices) {
                        var flag = db?.ExhFacilityDao()?.insert(ExhFacility(
                                nums[i].toInt(),
                                facs[i],
                                addrs[i],
                                xs[i].toDouble(),
                                ys[i].toDouble(),
                                homepages[i]
                        ))
                        Log.e(TAG, "[added exhfac from web] $flag")
                    }

                } catch (e: Exception) {
                    Log.e("Error_10001", "XPath failed", e)
                }
            })
        }

        fun request(url_str: String?): Document? {
            var outputDoc: Document? = null
            try {
                // HTTP로 URL주소 연결하기
                val url = URL(url_str)
                val conn = url.openConnection() as HttpURLConnection
                if (conn != null) {
                    conn.connectTimeout = 10000 // 10s이상이면 Timeout
                    conn.requestMethod = "GET"

                    // utf-8 인코딩으로 읽어오기
                    val isr = InputStreamReader(conn.inputStream, "utf-8")
                    val dbFactory = DocumentBuilderFactory.newInstance()
                    val builder = dbFactory.newDocumentBuilder()
                    outputDoc = builder.parse(InputSource(isr))
                    conn.disconnect()
                }
            } catch (e: IOException) {
                Log.e("Error_10001", "Exception in processing response", e)
            } catch (e: SAXException) {
                Log.e("Error_10001", "Exception in processing response", e)
            } catch (e: ParserConfigurationException) {
                Log.e("Error_10001", "Exception in processing response", e)
            }
            return outputDoc
        }
    }

}</code></pre><p id="e3722bdf-babc-49fe-8d54-2235e76c3a98" class="">
</p><h2 id="20185dfe-70cc-4d0f-a7a4-9b6f83595778" class="">참조 사이트</h2><figure id="cca94012-f586-44b2-9408-2b0b32bcae18"><a href="https://developers.google.com/maps/documentation/android-sdk/current-place-tutorial" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Select Current Place and Show Details on a Map | Maps SDK for Android</div><div class="bookmark-description">This tutorial shows you how to find the current location of an Android device and display details of the place (a business or other point of interest) at that location. Follow this tutorial to build an Android app using the Maps SDK for Android, the Places SDK for Android, and the fused location provider in the Google Play services location APIs.</div></div><div class="bookmark-href"><img src="https://www.gstatic.com/devrel-devsite/prod/vbd904f2719533e871e3800dda1bebc56aa0bc95c3c9d01c4d7cebcf129bdf26c/developers/images/favicon.png" class="icon bookmark-icon"/>https://developers.google.com/maps/documentation/android-sdk/current-place-tutorial</div></div><img src="https://www.gstatic.com/devrel-devsite/prod/vbd904f2719533e871e3800dda1bebc56aa0bc95c3c9d01c4d7cebcf129bdf26c/developers/images/opengraph/white.png" class="bookmark-image"/></a></figure><figure id="6977228c-e285-4fa2-b28f-ab79e89add7a"><a href="https://kotlinlang.org/docs/classes.html#secondary-constructors" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Classes - Help | Kotlin</div><div class="bookmark-description">Classes in Kotlin are declared using the keyword class: class Invoice { /*...*/ } The class declaration consists of the class name, the class header (specifying its type parameters, the primary constructor etc.) and the class body, surrounded by curly braces.</div></div><div class="bookmark-href"><img src="https://kotlinlang.org/assets/images/favicon.ico" class="icon bookmark-icon"/>https://kotlinlang.org/docs/classes.html#secondary-constructors</div></div></a></figure><p id="18d0e3c4-7a77-482b-85cb-4b070edb4aba" class="">
</p></div></article></body></html>